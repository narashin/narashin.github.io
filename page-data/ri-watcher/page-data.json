{"componentChunkName":"component---src-templates-blog-template-js","path":"/ri-watcher/","result":{"data":{"cur":{"id":"c4a57922-7052-541c-a585-2429f656d430","html":"<p><img src=\"~@img/ri-watcher/ri-watcher-sc.png\" alt=\"~@img/ri-watcher/ri-watcher-sc.png\"></p>\n<h1 id=\"0-목적\" style=\"position:relative;\"><a href=\"#0-%EB%AA%A9%EC%A0%81\" aria-label=\"0 목적 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. 목적</h1>\n<p>AWS RI 리소스들의 Retired 날짜를 잊고 지내다가, 제때 재구매를 하지 못해 Ondemand 비용을 지불하고 사용하는 경우를 방지하기 위해 만들어졌습니다.</p>\n<h1 id=\"1-작동\" style=\"position:relative;\"><a href=\"#1-%EC%9E%91%EB%8F%99\" aria-label=\"1 작동 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 작동</h1>\n<ul>\n<li>EC2, RDS, ElastiCache, ElasticSearch, Redshift의 RI를 다룹니다.</li>\n<li>cron()이나 rate() 표기식으로 RI 만기일이 체크 주기를 정할 수 있습니다.</li>\n<li>Slack으로 알림을 줍니다.</li>\n</ul>\n<h1 id=\"2-code-classlanguage-textsettingymlcode\" style=\"position:relative;\"><a href=\"#2-code-classlanguage-textsettingymlcode\" aria-label=\"2 code classlanguage textsettingymlcode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. <code class=\"language-text\">setting.yml</code></h1>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">SLACK_WEBHOOK_URL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token comment\"># SLACK WEBHOOK URL</span>\n<span class=\"token key atrule\">SCHEDULE</span><span class=\"token punctuation\">:</span> cron(0 1 * * <span class=\"token punctuation\">?</span> <span class=\"token important\">*)</span> <span class=\"token comment\"># cron() or rate()</span>\n<span class=\"token key atrule\">PROFILE</span><span class=\"token punctuation\">:</span> default <span class=\"token comment\"># AWS Profile in your local</span>\n<span class=\"token key atrule\">REGION</span><span class=\"token punctuation\">:</span> ap<span class=\"token punctuation\">-</span>northeast<span class=\"token punctuation\">-</span><span class=\"token number\">2</span> <span class=\"token comment\"># Target region</span></code></pre></div>\n<ul>\n<li>SLACK_WEBHOOK_URL : 슬랙 웹훅 URL 을 기입합니다.</li>\n<li>SCHEDULE : cron(), rate() 표현식으로 봇이 얼마 주기로 RI 만기일을 체크할지 정합니다.</li>\n<li>PROFILE : 본 코드를 Deploy할 AWS Profile을 정합니다. 또한 해당 Profile의 RI 리소스를 검사합니다.</li>\n<li>REGION : 타겟 리전을 정합니다. (서울은 <code class=\"language-text\">ap-northeast-2</code>)</li>\n</ul>\n<h1 id=\"그-외\" style=\"position:relative;\"><a href=\"#%EA%B7%B8-%EC%99%B8\" aria-label=\"그 외 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그 외</h1>\n<p>RI Watcher는 Serverless Framework를 이용하여 만들어졌으며 기본적으로 Serverless Framework가 설치되어 있는 환경에서 deploy 가능합니다.</p>","excerpt":"~@img/ri-watcher/ri-watcher-sc.png 0. 목적 AWS RI 리소스들의 Retired 날짜를 잊고 지내다가, 제때 재구매를 하지 못해 Ondemand 비용을 지불하고 사용하는 경우를 방지하기 위해 만들어졌습니다. 1. 작동 EC2, RDS, ElastiCache, ElasticSearch, Redshift의 RI를 다룹니다. cron()이나 rate() 표기식으로 RI 만기일이 체크 주기를 정할 수 있습니다. Slack으로 알림을 줍니다. 2.  SLACK_WEBHOOK_URL : 슬랙 웹훅 URL 을 기입합니다. SCHEDULE : cron(), rate() 표현식으로 봇이 얼마 주기로 RI 만기일을 체크할지 정합니다. PROFILE : 본 코드를 Deploy할 AWS Profile을 정합니다. 또한 해당 Profile의 RI 리소스를 검사합니다. REGION : 타겟 리전을 정합니다. (서울은 ) 그 외 RI Watcher는 Serverless Fram…","frontmatter":{"date":"Invalid date","title":"RI Watcher","categories":"craft","author":"신나라","emoji":"🔨"},"fields":{"slug":"/ri-watcher/"}},"next":{"id":"fc8b1bf5-0642-5648-97f2-4b00bbf94892","html":"<h2 id=\"0-시나리오\" style=\"position:relative;\"><a href=\"#0-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\" aria-label=\"0 시나리오 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. 시나리오</h2>\n<p>AWS 보안그룹이 수정, 생성, 삭제 됐을 때 알림을 받고 싶다.</p>\n<ol>\n<li>CloudTrail 을 이용하여 Write 된 내역을 추적한다.</li>\n<li>CloudWatch Event 를 통해 1 중, 특정 이벤트(EC2 Security Group 편집)가 발생했을 때 Lambda를 호출하게 한다.</li>\n<li>Lambda에 Slack 메시지를 보낼 수 있게 코드를 작성한다.</li>\n<li>이 모든 과정에 필요한 IAM Role, CloudWatch Event, Lambda 등을 따로 작성하지 않고 Serverless Framwork 를 이용하여 Wrapping 된 파일을 이용한다.</li>\n</ol>\n<h2 id=\"1-cloudtrail-설정하기\" style=\"position:relative;\"><a href=\"#1-cloudtrail-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"1 cloudtrail 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. CloudTrail 설정하기</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJUlEQVQoz12RSU9TURiG+yPUhBlEb1tGS6G3XCiUFoQg1EqKQHEogyAUkGiMURdESTRBFyYuxAVxg9EdCxGKLcigEFkY+QFoYcGwaBOMqcvHnNMixpM8ee8958v7TbrTJjtKkR1DsQO92YFSVIXe/A+Jf8VkR8Ym9H+Eh1DdyQIb2YUVHGpGrkaKXiVZsZBiUOPoVbLyy2VMVoGNU2cqjzDZpWYm3nWZeWUUaHVcH75P7/A9Gpo7aOscxHO5D1/fLdq7b9DiG6BQqyNJsTA+McnSpzXmQosEgh95HwixsvqFl69ek56roROZc9UaLl0bxtXaTb3HJw0v+vw0tffi9vbg7RpCdZyXVQuT75ubbHzbIBqN8vPgAHFWVtdJM1qPWi6xuzBXNFB+1kO1qx1jSTVFtnMUVzZiq23G6rxAklJCcGGF37EYu7t7RKJR9vb3icViBEJLpOWUigptcvBaTZM0FFnSczTEfWZeuZxdRl6Z1GS9henAPDs7u/wIbxPe2iYc3iISiTAbXCRdGIqBipadjV6cLi+V9S1o1U1YnW5Uh1smEdWpVS4USx2fp9/A8mOYG4FfWxyetfWvcqG6E9lmUo1W2Z4gv7RWVpNqUOMYraQZSyXHs830+G/ydHSEB3dvM/roCQ/HnjP2bJyugTscyzKha+scii/han8cn5/WjoEEg3+/RUzzlX5eTEzydmqGqZkFZoKLvJsN8WFhWW65xefnD7wAgcy7Zc40AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__11.53.50.png\"\n        title=\"2020-07-20__11.53.50.png\"\n        src=\"/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/37523/2020-07-20__11.53.50.png\"\n        srcset=\"/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/e9ff0/2020-07-20__11.53.50.png 180w,\n/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/f21e7/2020-07-20__11.53.50.png 360w,\n/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/37523/2020-07-20__11.53.50.png 720w,\n/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/302a4/2020-07-20__11.53.50.png 1080w,\n/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/07a9c/2020-07-20__11.53.50.png 1440w,\n/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/10ab7/2020-07-20__11.53.50.png 1552w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol>\n<li>CloudTrail → 추적 생성</li>\n</ol>\n<h3 id=\"0-추적-속성-선택\" style=\"position:relative;\"><a href=\"#0-%EC%B6%94%EC%A0%81-%EC%86%8D%EC%84%B1-%EC%84%A0%ED%83%9D\" aria-label=\"0 추적 속성 선택 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(0) 추적 속성 선택</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACFUlEQVQ4y51UDZOaMBTk//+41rv2pue1d6KiqEggJHwEAtvZB1rP0WktMzsJSJZ9+/YZzJ6e8XX2JPj2/QVfZjMYa6GL4r8QHJIESmXY7fcjdntYa4X0URTGIEiSI368zjGfvyEMl+j7Hk3TwDn3EFrnUNc1AmMMSJplOcqyFMKu6x6G9x6NcyS0WEcb6MLA2BK2LDHg8zUMw1/Bi8RBWVXYxjtstrEQVnUN51q4doJzowrvBf4O+BvfDygzTZWUTDJ+oCiMdKwwFlmu0bYtZYodt+CntaXCumkmoloUFhIZAz4XP32Pphvh+2szJkumtTsRUk2qMuS5FkVErotRqa0QFw2irIYqWzkunolvEy49rKoKqVJgtwvX418vUlDwGcCfkhnI1XqNcBXhmCoxl8/pL80eeo9fucNzlOJ1FeMl3CI8ahyqDjvrsLcO27KDcS0CstIrqszzHCrLpFyWTyvYwb732FUei0TjIz5isc+wTHJEyiJSBuujxqZwsK4bu8xo8CDJcSeDzQDUA+AwgvvSj6h6wPoBNWOTa433jwUW4VLA8qmQnWZzeM/ua62lAnrNPcfs7OZlU+rGycFtHMufA0nD5Qr7QyIejoRWvH37+T56LBX1tyeF0VBK4XBIBJL6aTYvS77en+4v1/Po0fxaRs6hnyaC6T+NVHfl7b2PfAr2KcwqywUMOp9xz5Ul3iK7VvgblyB1JrTOVpEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__11.57.31.png\"\n        title=\"2020-07-20__11.57.31.png\"\n        src=\"/static/cfee7235ea5cd3a180667e689a91531c/37523/2020-07-20__11.57.31.png\"\n        srcset=\"/static/cfee7235ea5cd3a180667e689a91531c/e9ff0/2020-07-20__11.57.31.png 180w,\n/static/cfee7235ea5cd3a180667e689a91531c/f21e7/2020-07-20__11.57.31.png 360w,\n/static/cfee7235ea5cd3a180667e689a91531c/37523/2020-07-20__11.57.31.png 720w,\n/static/cfee7235ea5cd3a180667e689a91531c/302a4/2020-07-20__11.57.31.png 1080w,\n/static/cfee7235ea5cd3a180667e689a91531c/e40ed/2020-07-20__11.57.31.png 1378w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>추적 이름 지정</li>\n<li>스토리지 위치 지정 - 새 S3 버킷에 생성해도 되고, 기존 버킷을 이용해도 OK</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAx0lEQVQoz52Qi2rDMBAE/f8fWShyYuHUkfVyJEvyFInWkJIQpwvLwWmZu1NnnUeOF4ToOQ8SOQyMV4OLhapt23il30wphW5ykY9hoheCnHNrlrLtobeBxnk+xQkpZWs8Ctb6yjtwXiJiVNwW/wfCYd0BQwgopZimK+u6Ht7o6YZ+WRgvX/SnM7PW+0MN1Vr/9ahTSnS3EDDONSutMdZirMMYSx32L6C1Dm0sIURC/HEIrCnxjtrJznvUrNvZFXA3MefWO+oYI99JmMPFA4viKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__11.57.37.png\"\n        title=\"2020-07-20__11.57.37.png\"\n        src=\"/static/0bb217002f3f779398d256f2d02573d2/37523/2020-07-20__11.57.37.png\"\n        srcset=\"/static/0bb217002f3f779398d256f2d02573d2/e9ff0/2020-07-20__11.57.37.png 180w,\n/static/0bb217002f3f779398d256f2d02573d2/f21e7/2020-07-20__11.57.37.png 360w,\n/static/0bb217002f3f779398d256f2d02573d2/37523/2020-07-20__11.57.37.png 720w,\n/static/0bb217002f3f779398d256f2d02573d2/302a4/2020-07-20__11.57.37.png 1080w,\n/static/0bb217002f3f779398d256f2d02573d2/1e093/2020-07-20__11.57.37.png 1376w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>KMS를 사용한다면 KMS 키 설정</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5UlEQVQ4y6VU2W7bMBDU//9Ui77FzvFUtE2T+JZtWScpXqKkKXYlWantxEZLYLBLco8huctASomiKCCEAOlKKWR5zrDWoqoqOOdgnWP5EWhfliWCu8k9vnz9hun0AZPpPX78/IWHxyfcTaaIogMjTlLklCTLkaQZz0mPkwRpmjEoGJEJ9lEMKUtU3sM5C2sMTA9aL5h5iVIplKViR56TLuVxTvZkE4iiy8QMpIauaqBt0bQty260aNsRw5x32lHXWiP4Pt/i5fkZpRRQtkJVj4bv5WdjsCGWwSFJsTskkK65yOZWMEMKSJecZjl8g38KdBZwFQtoVY7U3x3x1OHakTmgFAL7KOIXuuZ0E8Nwu8Pvl1fMF0vGbL7A69sMb7M515w2FkobLvCq8r3s4X2HXueARSHYsRCyq7tCcNHmhYCQkkE1d435yHCzwTaKcRCGW81Yy61EWY2xbGStO0paU0pDaY26ac7vcHeIub2cq3hBc5fYUWrToZ8PQQnNpYBhVsJojf8ZfwcMQ+5XGpSRNofMJJsbanCw4YDb3R6r9QaL5QrrTYjlas36JtyyvlqveZ++p+OLnrw03TuVHbce3QW9pPeeL7mu64s4/QyOwGnrJSmoFikbOXrf40z3H4JYkg19X38ArNd6hnj4sDIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__11.59.15.png\"\n        title=\"2020-07-20__11.59.15.png\"\n        src=\"/static/1bf5917a0214c8441e8cead4d6a7df55/37523/2020-07-20__11.59.15.png\"\n        srcset=\"/static/1bf5917a0214c8441e8cead4d6a7df55/e9ff0/2020-07-20__11.59.15.png 180w,\n/static/1bf5917a0214c8441e8cead4d6a7df55/f21e7/2020-07-20__11.59.15.png 360w,\n/static/1bf5917a0214c8441e8cead4d6a7df55/37523/2020-07-20__11.59.15.png 720w,\n/static/1bf5917a0214c8441e8cead4d6a7df55/302a4/2020-07-20__11.59.15.png 1080w,\n/static/1bf5917a0214c8441e8cead4d6a7df55/d5b59/2020-07-20__11.59.15.png 1370w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Log를 남기겠습니다.</li>\n<li>IAM 역할을 지정\n<ul>\n<li>새로 만들어야 한다면 <code class=\"language-text\">> 정책문서</code> 를 클릭하여 나오는 JSON을 참고하여 생성</li>\n</ul>\n</li>\n<li><code class=\"language-text\">다음</code></li>\n</ul>\n<h3 id=\"1-로그-이벤트-선택\" style=\"position:relative;\"><a href=\"#1-%EB%A1%9C%EA%B7%B8-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EC%84%A0%ED%83%9D\" aria-label=\"1 로그 이벤트 선택 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(1) 로그 이벤트 선택</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/UlEQVQ4y51Ta3PTMBD0//9ZDHwpAx0ehZa0sVtomkSyJFtvy/HCnVNIAjOl1cyO7LvTae9uVV18+Ypvi2u8ev0G796f4/zDR5DNeQ/Tdej6/lmotkLwQdm22G4FlNLs8CHAez/vR/AIJ3DeMQFrHSohJc7O3uJ2o2B9RPCenc45TuDcHGidY5v1AdpFKBth3IyUM0opCCGg6q1FqzSzpJ0Ytkrxbkw3/7cKslWzvbO4Vw53ct4bYeFCQikDE6hiDDDGcHm0dtOEaZrwrzVhAth37N/tdnyGmFZt53B106CuGyht0FvHAbTKOHLJMcbjxHQ4JYQQkVL+bR+GAdVKOzQPApv1mhOGGLlnOQ/QxqC5vcOP+xUnppKIBV1K9mXd4GG9QYyJL4gpoaIpUYJSRg6mROSkJlMSbTpOTN+Zmr9nTT0lApSMzlA8l0yMxnHkwJwTMyQQm8fvQzza4x6HPlJCRRNc1jUWi2uspYEPf4KfA6qKBluRoC+vFvj0+QLL7ytshIRSiqUiZAvSKWErZnRdxxIZcuYhHCLMsoksWJbKNGEcC/eDejrvJxhHbtEpSBk8FKr7Zlnz7T0Pp+ClK5NshlLg6UnFjFpapL3mpr3A/xecMA+oiFHf95CyxWYrIYTkcl+yWNgkg/kdK2itobSG9+EvSTwFnsWvKf8E7YnVaO+yuCsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__12.59.21.png\"\n        title=\"2020-07-20__12.59.21.png\"\n        src=\"/static/e3c197c86cb639208a6d5e00977b6806/37523/2020-07-20__12.59.21.png\"\n        srcset=\"/static/e3c197c86cb639208a6d5e00977b6806/e9ff0/2020-07-20__12.59.21.png 180w,\n/static/e3c197c86cb639208a6d5e00977b6806/f21e7/2020-07-20__12.59.21.png 360w,\n/static/e3c197c86cb639208a6d5e00977b6806/37523/2020-07-20__12.59.21.png 720w,\n/static/e3c197c86cb639208a6d5e00977b6806/302a4/2020-07-20__12.59.21.png 1080w,\n/static/e3c197c86cb639208a6d5e00977b6806/e40ed/2020-07-20__12.59.21.png 1378w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>수정된 목록만 받아 볼 예정이기 때문에 API 활동 → 쓰기 에만 체크 합니다.</li>\n<li><code class=\"language-text\">다음</code>\n<ul>\n<li>검토 및 생성</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA90lEQVQoz52R626DMAyF8/4PuLXSRCeGNgKEQS6OQwhnSqpOpUOTth+fHNknx3YiXuSMUVu0ssVHK6GNwax1if9BPD2fcDqf0Y8TJp2T+k+GWXuPqC6vqKoKtVRQkz4U/UbWW+dgnb1O2EoJCguWEMDM8MwlPuJveL/TWOsgux7DoGCthaibd8jJIYSAkI2Xn+Ta7Rxj3OUcUXn7bOocQXRSYltjmTCL+BHmcjGvY6zF0I8gR1ct87dxbkTeQ3waguMIChFrSkgHbFvCuq6Ffu5AwWHbtr0mpWIsGmXw1s9oBg3jqHQhOsBfaVQNNSt4z2Xd+3r+nC84m2kj8ELXTwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__1.08.19.png\"\n        title=\"2020-07-20__1.08.19.png\"\n        src=\"/static/5a1a0631c037a6c27f761401ab6d5370/37523/2020-07-20__1.08.19.png\"\n        srcset=\"/static/5a1a0631c037a6c27f761401ab6d5370/e9ff0/2020-07-20__1.08.19.png 180w,\n/static/5a1a0631c037a6c27f761401ab6d5370/f21e7/2020-07-20__1.08.19.png 360w,\n/static/5a1a0631c037a6c27f761401ab6d5370/37523/2020-07-20__1.08.19.png 720w,\n/static/5a1a0631c037a6c27f761401ab6d5370/302a4/2020-07-20__1.08.19.png 1080w,\n/static/5a1a0631c037a6c27f761401ab6d5370/52ab5/2020-07-20__1.08.19.png 1420w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"2-serverless-framwork-로-작성한-코드-사용하기\" style=\"position:relative;\"><a href=\"#2-serverless-framwork-%EB%A1%9C-%EC%9E%91%EC%84%B1%ED%95%9C-%EC%BD%94%EB%93%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"2 serverless framwork 로 작성한 코드 사용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. serverless-framwork 로 작성한 코드 사용하기</h2>\n<h3 id=\"1-panopticon-받기\" style=\"position:relative;\"><a href=\"#1-panopticon-%EB%B0%9B%EA%B8%B0\" aria-label=\"1 panopticon 받기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(1) Panopticon 받기</h3>\n<p><a href=\"https://github.com/narashin/AWS-CloudTrail-Panopticon\">narashin/AWS-CloudTrail-Panopticon</a></p>\n<p>🔼Panopticon 받기</p>\n<h3 id=\"2-serverless-설치\" style=\"position:relative;\"><a href=\"#2-serverless-%EC%84%A4%EC%B9%98\" aria-label=\"2 serverless 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(2) serverless 설치</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> serverless</code></pre></div>\n<h3 id=\"3-deploy-전-환경변수-설정하기\" style=\"position:relative;\"><a href=\"#3-deploy-%EC%A0%84-%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"3 deploy 전 환경변수 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(3) deploy 전 환경변수 설정하기</h3>\n<ul>\n<li><code class=\"language-text\">serverless.yml</code> 생성</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token literal-property property\">service</span><span class=\"token operator\">:</span> cloudwatch<span class=\"token operator\">-</span>ec2<span class=\"token operator\">-</span>sg\n\n<span class=\"token literal-property property\">provider</span><span class=\"token operator\">:</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> aws\n  <span class=\"token literal-property property\">runtime</span><span class=\"token operator\">:</span> nodejs12<span class=\"token punctuation\">.</span>x\n  <span class=\"token literal-property property\">stage</span><span class=\"token operator\">:</span> dev\n  <span class=\"token literal-property property\">region</span><span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Region</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  iamRoleStatements:\n    - Effect: \"Allow\"\n      Action:\n        - \"ec2:DescribeSecurityGroups\"\n      Resource: \"*\"\n  environment: \n    SLACK_URL: \"&lt;보낼 채널의 WEBHOOK_URL>\"\n\nfunctions:\n  panopticon:\n    handler: handler.panopticon\n    events:\n      - cloudwatchEvent:\n          event:\n            source:\n              - \"aws.ec2\"\n            detail-type:\n              - \"AWS API Call via CloudTrail\"\n            detail:\n                eventSource:\n                    - \"ec2.amazonaws.com\"\n                eventName:\n                    - \"CreateSecurityGroup\"\n                    - \"DeleteSecurityGroup\"\n                    - \"RevokeSecurityGroupIngress\"\n                    - \"RevokeSecurityGroupEgress\"\n                    - \"AuthorizesecuritygroupIngress\"\n                    - \"AuthorizesecuritygroupEgress\"</span></code></pre></div>\n<ul>\n<li>Nodejs12.x</li>\n<li>iamRole : <code class=\"language-text\">\"ec2:DescribeSecurityGroups\"</code> 허용</li>\n<li>CloudwatchEvent On\n<ul>\n<li>EC2 Event Source 들\n<ul>\n<li>“CreateSecurityGroup”</li>\n<li>“DeleteSecurityGroup”</li>\n<li>“RevokeSecurityGroupIngress”</li>\n<li>“RevokeSecurityGroupEgress”</li>\n<li>“AuthorizesecuritygroupIngress”</li>\n<li>“AuthorizesecuritygroupEgress”</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"4-code-classlanguage-textsls-deploycode-하기\" style=\"position:relative;\"><a href=\"#4-code-classlanguage-textsls-deploycode-%ED%95%98%EA%B8%B0\" aria-label=\"4 code classlanguage textsls deploycode 하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(4) <code class=\"language-text\">sls deploy</code> 하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ sls deploy</code></pre></div>\n<ul>\n<li>먼저 프로그래밍 방식의 IAM AWS Access Key, Secret Key로 aws configure가 작성 되어있어야 함.\n<ul>\n<li><code class=\"language-text\">aws configure</code> 로 확인.</li>\n</ul>\n</li>\n<li>Serverless 가 설치되어 있어야 함.</li>\n<li>Slack Webhook URL이 설정되어 있어야 함.</li>\n</ul>\n<h2 id=\"3-실제-동작-화면\" style=\"position:relative;\"><a href=\"#3-%EC%8B%A4%EC%A0%9C-%EB%8F%99%EC%9E%91-%ED%99%94%EB%A9%B4\" aria-label=\"3 실제 동작 화면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 실제 동작 화면</h2>\n<h3 id=\"1-보안그룹-생성\" style=\"position:relative;\"><a href=\"#1-%EB%B3%B4%EC%95%88%EA%B7%B8%EB%A3%B9-%EC%83%9D%EC%84%B1\" aria-label=\"1 보안그룹 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(1) 보안그룹 생성</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABUElEQVQoz51TTWuDQBDdn9q/kRyFHqq9lfYHlKSnnnorBC1IDukhhRz0UGPd+IklGA0ksUZfGG3SaiExfTDsMMy+ffOxLI5jzOdzRFFUnmRBEMB1Xdi2Dc/zDv5mswGhKApUKGo+GZvNZtA0DXSuViukaYo9KLlpzTjh1dtCtSkOMN/3MTWmJSGpS5KkoaKO36T5t3//luLi0YL+GYCRutFohMlkguVy+efSaYU5VA5cvih4fn8C6/V6EAQBoihCluXahTb4ycvxtc3AOOewLAuLaFEqDMMQ6/X6aNnNRyu/ijNucQyHQ6iqWk6TJpllWQvCvdXbwBzHwUO/D/FKhGEYlfg8b11yE4x7IW5u7yBJEiTpGoqi1EjPJWbmB4csKxgMBjBNE7Top8o9SujYdjkUIqNfQYtN6s6d9oGQFlvX9XJ1Op0Out0uxuPxv3u5A0BHlX4wHZXDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__1.43.36.png\"\n        title=\"2020-07-20__1.43.36.png\"\n        src=\"/static/1d55a5a815fa29d48ba12e24f119055c/37523/2020-07-20__1.43.36.png\"\n        srcset=\"/static/1d55a5a815fa29d48ba12e24f119055c/e9ff0/2020-07-20__1.43.36.png 180w,\n/static/1d55a5a815fa29d48ba12e24f119055c/f21e7/2020-07-20__1.43.36.png 360w,\n/static/1d55a5a815fa29d48ba12e24f119055c/37523/2020-07-20__1.43.36.png 720w,\n/static/1d55a5a815fa29d48ba12e24f119055c/302a4/2020-07-20__1.43.36.png 1080w,\n/static/1d55a5a815fa29d48ba12e24f119055c/8d68c/2020-07-20__1.43.36.png 1234w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"2-보안그룹-삭제\" style=\"position:relative;\"><a href=\"#2-%EB%B3%B4%EC%95%88%EA%B7%B8%EB%A3%B9-%EC%82%AD%EC%A0%9C\" aria-label=\"2 보안그룹 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(2) 보안그룹 삭제</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABV0lEQVQoz51Sy2rCQBSdf3Xtzn0huy4rgrtAESlIRXARd9JNFyHZBLpRQZOYNA+M5mGEhM6cMiMD9qGtXrgzZx73cO6DFHmB3XaHNE2RZZnwZJMgCAL4vo8oioRznOc5uDHGIO0UAwxkuVzCsizM53MRcDgccMkkAd8pPWJrkeF+4MJYVSBxHMPzPIRhKFQWRSE+n3NJJgjFmcEIGe4e3+ANRiC6rmOiTTCdTuE4zpeAU3zujhOmH8BmYQOjJ5But4tms4lWq4V+v3+mNpdKcKydXEnwHoCnXVc1KKUC7/f7P0n5k1QoMaMUxLZtjMdjDJ+HME0TZVmirusrVDKhTJaArNcueNqKokDTtKtT/m4k3OZ4edXRbj9AVVV0Oh0kSfKjOf8mdFwPumEKdXwWeaerqrpZJeEzaK9WcF0XcRT/OsBXEfqeL5TNZjMxOo1GA71e7+aUPwE+8pM55119CwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__1.42.49.png\"\n        title=\"2020-07-20__1.42.49.png\"\n        src=\"/static/232b4815a9294d4c0ba508a993e3d8e3/37523/2020-07-20__1.42.49.png\"\n        srcset=\"/static/232b4815a9294d4c0ba508a993e3d8e3/e9ff0/2020-07-20__1.42.49.png 180w,\n/static/232b4815a9294d4c0ba508a993e3d8e3/f21e7/2020-07-20__1.42.49.png 360w,\n/static/232b4815a9294d4c0ba508a993e3d8e3/37523/2020-07-20__1.42.49.png 720w,\n/static/232b4815a9294d4c0ba508a993e3d8e3/302a4/2020-07-20__1.42.49.png 1080w,\n/static/232b4815a9294d4c0ba508a993e3d8e3/5c744/2020-07-20__1.42.49.png 1206w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"3-보안그룹-수정\" style=\"position:relative;\"><a href=\"#3-%EB%B3%B4%EC%95%88%EA%B7%B8%EB%A3%B9-%EC%88%98%EC%A0%95\" aria-label=\"3 보안그룹 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(3) 보안그룹 수정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6klEQVQ4y51Uu27iQBSdX6ZciSJbgJSlQZuChmK7JRVF2igVUhoigYQjzMPGLzCxeXnNYmPss7qXQAwBVmSko/E8fObMuXOv+K3cw7UdGIYB27YxGo0Yw+EQuq7zvGmasCyLv1VV5fXNZoPjliQJhGoq6Ha7mEwmvCmKIqzXa0YYhAiCAGEY7rFarbiPk4RJ/GWEp2cbL68ej4WhGej1etC1rRo6nZT6f3xcau988IIY3x4m+PXYAdZ/ITRNgyzLTEIqfd9n6XEcc38JQIIgBp7aNtSXChBHELlcDplMBtlsFo1GY+9Fuj+vcre+9ZNGotPpQJIkDsJ8Psdisdgb/qHkPBnfJnkfU1BarRaazSZHdDweYzabHRBeVEcHHh0sCj9u8f3mBoVCAf1+nyfJv682IfcH+Hl3h1KphHK5jHa7vSf9n4cnCV/lHiqVe1SrVdRqNfYy7d+1ELqmcSa4jnsmglcqJEX1eh35fJ5RLBY5QOlrX6WQUoueCz1u8k9qSRxpItsh/UN6/hhMSElPcBwH0+mUQRZ4nnfgJT2ldKDOWSIody1zS0gF4ZSPy+USA3XAAXNd92D905VJHW2knKbiQNXmMF/B+U2q6XBFUTgBPud1WqFl8aYdOZEeK9wRUhGhfW/jt5PX/weE+BT3+UhpIwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__1.43.51.png\"\n        title=\"2020-07-20__1.43.51.png\"\n        src=\"/static/b1a819fcbb26d6562b61c8ef4732069e/37523/2020-07-20__1.43.51.png\"\n        srcset=\"/static/b1a819fcbb26d6562b61c8ef4732069e/e9ff0/2020-07-20__1.43.51.png 180w,\n/static/b1a819fcbb26d6562b61c8ef4732069e/f21e7/2020-07-20__1.43.51.png 360w,\n/static/b1a819fcbb26d6562b61c8ef4732069e/37523/2020-07-20__1.43.51.png 720w,\n/static/b1a819fcbb26d6562b61c8ef4732069e/302a4/2020-07-20__1.43.51.png 1080w,\n/static/b1a819fcbb26d6562b61c8ef4732069e/5a791/2020-07-20__1.43.51.png 1248w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>보안그룹 상세 추가 수정</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACN0lEQVQ4y51UO4/aQBDef0pNQw1cilT0d4D4AclRUCEeadIBCkXQwUU6FHCEhY1twAbOPMTbXzSDFuHwOJGRPljY2W/nm50ZsX55wcR14dg2bNvGcDBk9Ho9aJoGXddhGMbxd7fbheu6IPM8D37zICxVRafTYbLdbsfYbrdYrVZYLpeM0zWB9iXXcrXDz1cbr79d7PaA6Oo6/igKdE0/RkPk+/0et0xGt9p6+Fwc4fGbCm+1gCAJrVYLpmFiOBxiMplwlHTgI5DErQd8b7/j7cczsJ5CRKNRBAIBBINBlEol3+3nOfLni3QfPLYA1rwWzWYT9XodqqpiPB5jNptxhJLwGqknyTwP+wM3fwh6PZJNZCTXsR1O+kcR8t6JEukrPj08IBQKIRKJcKRkMsL/MVH/9YbHpyckEgmk02koisIb9Mq3c3iFUFE1fPn6zGTFYhHtdtsn414IrdvlLphOpxfr7O4IDcNEpVJBOBxmxGIxLvBT2XdFSK1EBV2tVhnlchmj0ehIKCEPnP73L5jQMi2YpsklQyAyqknHcXy5PH0kWm82Gy4vWWJHyYPBAASK8pqRCsoz+cmLruVb9Pt9dqahUKvVkEqljqA9svl8zvukhL6pGuLxOJLJJDKZjE+JIAeac3Q7lUw+n0ehUGBQ95AtFgsmoseidaPRQDabRS6X8/W/J1uPCGnaXOoQ6Shn5aVyOpNMUojUsixO+K3D8lGkj5ybxwg5h3qP5R0m8XnDn8/B65PoL/5x8YIeI209AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__1.43.24.png\"\n        title=\"2020-07-20__1.43.24.png\"\n        src=\"/static/69c06d5cd222c816285887263aa838cd/37523/2020-07-20__1.43.24.png\"\n        srcset=\"/static/69c06d5cd222c816285887263aa838cd/e9ff0/2020-07-20__1.43.24.png 180w,\n/static/69c06d5cd222c816285887263aa838cd/f21e7/2020-07-20__1.43.24.png 360w,\n/static/69c06d5cd222c816285887263aa838cd/37523/2020-07-20__1.43.24.png 720w,\n/static/69c06d5cd222c816285887263aa838cd/302a4/2020-07-20__1.43.24.png 1080w,\n/static/69c06d5cd222c816285887263aa838cd/8affb/2020-07-20__1.43.24.png 1254w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>보안그룹 상세 삭제</li>\n</ul>","frontmatter":{"date":"Invalid date","title":"Panopticon","categories":"craft","author":"신나라","emoji":"🔨"},"fields":{"slug":"/panopticon/"}},"prev":{"id":"3f04f744-98a7-5238-977e-0def1fea31f5","html":"<h2 id=\"a-cloudflare-의-advanced-ddos-를-이용한-방어-전략\" style=\"position:relative;\"><a href=\"#a-cloudflare-%EC%9D%98-advanced-ddos-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%B0%A9%EC%96%B4-%EC%A0%84%EB%9E%B5\" aria-label=\"a cloudflare 의 advanced ddos 를 이용한 방어 전략 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A. Cloudflare 의 Advanced DDoS 를 이용한 방어 전략</h2>\n<ol>\n<li>봇넷을 통해 공격이 들어오면 데이터베이스에 부하가 발생하고, 서비스 요청이 정상적으로 처리되지 않는다</li>\n<li>서비스 운영자는 이를 확인하고 Cloudflare 에서 <strong>I’m Under Attack</strong> 모드를 활성화한다</li>\n<li>하지만 언젠가부터 <strong>I’m Under Attack</strong> 을 통과하는 방식의 공격이 발생하였다</li>\n<li>이를 방어하기 위해서 <strong>Rate Limiting</strong> 을 사용하여 방어하려고 하였으나, <strong>Rate Limit</strong> 집계 시점 이전에 이미 방대한 요청이 들어오기 때문에, <strong>능동 방어에는 시간이 걸린다(1분 이상)</strong></li>\n</ol>\n<h2 id=\"b-aws-waf-security-automations-template을-이용한-방어-전략\" style=\"position:relative;\"><a href=\"#b-aws-waf-security-automations-template%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%B0%A9%EC%96%B4-%EC%A0%84%EB%9E%B5\" aria-label=\"b aws waf security automations template을 이용한 방어 전략 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>B. AWS WAF Security Automations Template을 이용한 방어 전략</h2>\n<p><img src=\"~@img/shieldee/waf-securityAutomationtemplate.png\" alt=\"\"></p>\n<ol>\n<li>봇넷을 통해 공격이 들어오면 데이터베이스에 부하가 발생하고, 서비스 요청이 정상적으로 처리되지 않는다</li>\n<li>CloudFront 또는 Application Load Balancer 에서 Access Logs 를 활성화하고, S3에 저장하도록 한다</li>\n<li>S3에 Access Log가 적재된 이후에, Amazon Athena 가 해당 로그를 <strong>5분 단위로 집계</strong>하여, 지정한 요청 임계치를 초과한 IP들을 AWS WAF IP Set에 추가한다</li>\n</ol>\n<ul>\n<li>마찬가지로 집계 시점 이전에 이미 방대한 요청이 들어오므로, <strong>대응이 느리다(5분 이상)</strong></li>\n</ul>\n<h2 id=\"c-shieldee-의-대응-시나리오\" style=\"position:relative;\"><a href=\"#c-shieldee-%EC%9D%98-%EB%8C%80%EC%9D%91-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\" aria-label=\"c shieldee 의 대응 시나리오 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>C. Shieldee 의 대응 시나리오</h2>\n<p><img src=\"~@img/shieldee/shieldee.png\" alt=\"\"></p>\n<ol>\n<li>봇넷을 통해 공격이 들어오면 앞단 NGINX 에서 지정된 Rate Limiting 정책에 해당하는 개별 IP들을 에러 로그로 떨어뜨린다.</li>\n<li>해당 에러 로그를 탐지하자마자 곧바로 엣지 WAF 에 룰셋으로 해당 IP를 블락한다.\n<ul>\n<li>엣지 영역에서 블락하지 못한 트래픽들을 위한 최후방어선으로 동작하며,</li>\n<li><strong>Rate Limiting 탐지 이후 3초 안에 블락한다.</strong></li>\n</ul>\n</li>\n<li>일시적인 오탐 등을 고려하여 1시간 뒤에 해당 IP들을 해제한다.</li>\n</ol>\n<h2 id=\"2-동작-방식\" style=\"position:relative;\"><a href=\"#2-%EB%8F%99%EC%9E%91-%EB%B0%A9%EC%8B%9D\" aria-label=\"2 동작 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 동작 방식</h2>\n<ol>\n<li>봇넷을 통해 공격이 들어오면, NGINX 의 <strong>Rate Limiting</strong> 기능으로 개별 IP들의 초당 요청 수를 제한하도록 한다\n<ol>\n<li>이 때의 <strong>Rate Limiting</strong> 대상은 동적 컨텐츠 요청 영역으로만 한정한다</li>\n</ol>\n</li>\n<li><strong>Rate Limiting</strong> 에 적용된 IP 들은 NGINX 에러 로그 파일로 기록이 된다.</li>\n<li><strong>fluentd</strong> 로 에러 로그를 테일링(Tailing) 하여, <strong>Rate Limiting</strong> 로그 형식에 맞춰서 정규표현식으로 캡처를 한다</li>\n<li>캡처된 내용을 <strong>Amazon Kinesis Data Streams</strong> 로 전달하고,</li>\n<li><strong>Kinesis Data Streams</strong> 에서 트리거링된 <strong>AWS Lambda</strong> 가 동작하여, 전달된 IP를 <strong>DynamoDB</strong>에 기록한다.</li>\n<li>기록된 정보는 <strong>DynamoDB Streams</strong> 로 <strong>AWS Lambda</strong> 에 전달되는데, 이 때 해당 IP를 Cloudflare Access Rule 에 Block 모드로 추가한다\n<ol>\n<li>Access Rule 에 추가하고 반환받은 Access Rule Id를 <strong>DynamoDB</strong> 에 기록한다</li>\n<li>이 때, <code class=\"language-text\">expirationTime</code> 속성을 TTL 로 추가하고, 기본 TTL을 3600(1시간)으로 지정한다.</li>\n</ol>\n</li>\n<li><strong>DynamoDB</strong> 에서 TTL 이 경과된 항목이 삭제되면서, 해당 내용이 <strong>DynamoDB Streams</strong> 을 통해서 <strong>AWS Lambda</strong> 로 트리거링된다.\n<ol>\n<li><strong>DynamoDB</strong> 에 기록된 Access Rule Id 으로 Cloudflare Access Rule 에 등록된 IP를 해제한다</li>\n</ol>\n</li>\n</ol>","frontmatter":{"date":"Invalid date","title":"Shieldee","categories":"craft","author":"신나라","emoji":"🔨"},"fields":{"slug":"/shieldee/"}},"site":{"siteMetadata":{"siteUrl":"https://nara.dev","comments":{"utterances":{"repo":"narashin/narashin.github.io"}}}}},"pageContext":{"slug":"/ri-watcher/","nextSlug":"/panopticon/","prevSlug":"/shieldee/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}