{"componentChunkName":"component---src-templates-blog-template-js","path":"/panopticon/","result":{"data":{"cur":{"id":"fc8b1bf5-0642-5648-97f2-4b00bbf94892","html":"<h2 id=\"0-시나리오\" style=\"position:relative;\"><a href=\"#0-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\" aria-label=\"0 시나리오 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. 시나리오</h2>\n<p>AWS 보안그룹이 수정, 생성, 삭제 됐을 때 알림을 받고 싶다.</p>\n<ol>\n<li>CloudTrail 을 이용하여 Write 된 내역을 추적한다.</li>\n<li>CloudWatch Event 를 통해 1 중, 특정 이벤트(EC2 Security Group 편집)가 발생했을 때 Lambda를 호출하게 한다.</li>\n<li>Lambda에 Slack 메시지를 보낼 수 있게 코드를 작성한다.</li>\n<li>이 모든 과정에 필요한 IAM Role, CloudWatch Event, Lambda 등을 따로 작성하지 않고 Serverless Framwork 를 이용하여 Wrapping 된 파일을 이용한다.</li>\n</ol>\n<h2 id=\"1-cloudtrail-설정하기\" style=\"position:relative;\"><a href=\"#1-cloudtrail-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"1 cloudtrail 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. CloudTrail 설정하기</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJUlEQVQoz12RSU9TURiG+yPUhBlEb1tGS6G3XCiUFoQg1EqKQHEogyAUkGiMURdESTRBFyYuxAVxg9EdCxGKLcigEFkY+QFoYcGwaBOMqcvHnNMixpM8ee8958v7TbrTJjtKkR1DsQO92YFSVIXe/A+Jf8VkR8Ym9H+Eh1DdyQIb2YUVHGpGrkaKXiVZsZBiUOPoVbLyy2VMVoGNU2cqjzDZpWYm3nWZeWUUaHVcH75P7/A9Gpo7aOscxHO5D1/fLdq7b9DiG6BQqyNJsTA+McnSpzXmQosEgh95HwixsvqFl69ek56roROZc9UaLl0bxtXaTb3HJw0v+vw0tffi9vbg7RpCdZyXVQuT75ubbHzbIBqN8vPgAHFWVtdJM1qPWi6xuzBXNFB+1kO1qx1jSTVFtnMUVzZiq23G6rxAklJCcGGF37EYu7t7RKJR9vb3icViBEJLpOWUigptcvBaTZM0FFnSczTEfWZeuZxdRl6Z1GS9henAPDs7u/wIbxPe2iYc3iISiTAbXCRdGIqBipadjV6cLi+V9S1o1U1YnW5Uh1smEdWpVS4USx2fp9/A8mOYG4FfWxyetfWvcqG6E9lmUo1W2Z4gv7RWVpNqUOMYraQZSyXHs830+G/ydHSEB3dvM/roCQ/HnjP2bJyugTscyzKha+scii/han8cn5/WjoEEg3+/RUzzlX5eTEzydmqGqZkFZoKLvJsN8WFhWW65xefnD7wAgcy7Zc40AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__11.53.50.png\"\n        title=\"2020-07-20__11.53.50.png\"\n        src=\"/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/37523/2020-07-20__11.53.50.png\"\n        srcset=\"/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/e9ff0/2020-07-20__11.53.50.png 180w,\n/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/f21e7/2020-07-20__11.53.50.png 360w,\n/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/37523/2020-07-20__11.53.50.png 720w,\n/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/302a4/2020-07-20__11.53.50.png 1080w,\n/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/07a9c/2020-07-20__11.53.50.png 1440w,\n/static/50d2861f0a4fa3b2b3d2bb709ec6c94c/10ab7/2020-07-20__11.53.50.png 1552w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol>\n<li>CloudTrail → 추적 생성</li>\n</ol>\n<h3 id=\"0-추적-속성-선택\" style=\"position:relative;\"><a href=\"#0-%EC%B6%94%EC%A0%81-%EC%86%8D%EC%84%B1-%EC%84%A0%ED%83%9D\" aria-label=\"0 추적 속성 선택 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(0) 추적 속성 선택</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACFUlEQVQ4y51UDZOaMBTk//+41rv2pue1d6KiqEggJHwEAtvZB1rP0WktMzsJSJZ9+/YZzJ6e8XX2JPj2/QVfZjMYa6GL4r8QHJIESmXY7fcjdntYa4X0URTGIEiSI368zjGfvyEMl+j7Hk3TwDn3EFrnUNc1AmMMSJplOcqyFMKu6x6G9x6NcyS0WEcb6MLA2BK2LDHg8zUMw1/Bi8RBWVXYxjtstrEQVnUN51q4doJzowrvBf4O+BvfDygzTZWUTDJ+oCiMdKwwFlmu0bYtZYodt+CntaXCumkmoloUFhIZAz4XP32Pphvh+2szJkumtTsRUk2qMuS5FkVErotRqa0QFw2irIYqWzkunolvEy49rKoKqVJgtwvX418vUlDwGcCfkhnI1XqNcBXhmCoxl8/pL80eeo9fucNzlOJ1FeMl3CI8ahyqDjvrsLcO27KDcS0CstIrqszzHCrLpFyWTyvYwb732FUei0TjIz5isc+wTHJEyiJSBuujxqZwsK4bu8xo8CDJcSeDzQDUA+AwgvvSj6h6wPoBNWOTa433jwUW4VLA8qmQnWZzeM/ua62lAnrNPcfs7OZlU+rGycFtHMufA0nD5Qr7QyIejoRWvH37+T56LBX1tyeF0VBK4XBIBJL6aTYvS77en+4v1/Po0fxaRs6hnyaC6T+NVHfl7b2PfAr2KcwqywUMOp9xz5Ul3iK7VvgblyB1JrTOVpEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__11.57.31.png\"\n        title=\"2020-07-20__11.57.31.png\"\n        src=\"/static/cfee7235ea5cd3a180667e689a91531c/37523/2020-07-20__11.57.31.png\"\n        srcset=\"/static/cfee7235ea5cd3a180667e689a91531c/e9ff0/2020-07-20__11.57.31.png 180w,\n/static/cfee7235ea5cd3a180667e689a91531c/f21e7/2020-07-20__11.57.31.png 360w,\n/static/cfee7235ea5cd3a180667e689a91531c/37523/2020-07-20__11.57.31.png 720w,\n/static/cfee7235ea5cd3a180667e689a91531c/302a4/2020-07-20__11.57.31.png 1080w,\n/static/cfee7235ea5cd3a180667e689a91531c/e40ed/2020-07-20__11.57.31.png 1378w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>추적 이름 지정</li>\n<li>스토리지 위치 지정 - 새 S3 버킷에 생성해도 되고, 기존 버킷을 이용해도 OK</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAx0lEQVQoz52Qi2rDMBAE/f8fWShyYuHUkfVyJEvyFInWkJIQpwvLwWmZu1NnnUeOF4ToOQ8SOQyMV4OLhapt23il30wphW5ykY9hoheCnHNrlrLtobeBxnk+xQkpZWs8Ctb6yjtwXiJiVNwW/wfCYd0BQwgopZimK+u6Ht7o6YZ+WRgvX/SnM7PW+0MN1Vr/9ahTSnS3EDDONSutMdZirMMYSx32L6C1Dm0sIURC/HEIrCnxjtrJznvUrNvZFXA3MefWO+oYI99JmMPFA4viKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__11.57.37.png\"\n        title=\"2020-07-20__11.57.37.png\"\n        src=\"/static/0bb217002f3f779398d256f2d02573d2/37523/2020-07-20__11.57.37.png\"\n        srcset=\"/static/0bb217002f3f779398d256f2d02573d2/e9ff0/2020-07-20__11.57.37.png 180w,\n/static/0bb217002f3f779398d256f2d02573d2/f21e7/2020-07-20__11.57.37.png 360w,\n/static/0bb217002f3f779398d256f2d02573d2/37523/2020-07-20__11.57.37.png 720w,\n/static/0bb217002f3f779398d256f2d02573d2/302a4/2020-07-20__11.57.37.png 1080w,\n/static/0bb217002f3f779398d256f2d02573d2/1e093/2020-07-20__11.57.37.png 1376w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>KMS를 사용한다면 KMS 키 설정</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5UlEQVQ4y6VU2W7bMBDU//9Ui77FzvFUtE2T+JZtWScpXqKkKXYlWantxEZLYLBLco8huctASomiKCCEAOlKKWR5zrDWoqoqOOdgnWP5EWhfliWCu8k9vnz9hun0AZPpPX78/IWHxyfcTaaIogMjTlLklCTLkaQZz0mPkwRpmjEoGJEJ9lEMKUtU3sM5C2sMTA9aL5h5iVIplKViR56TLuVxTvZkE4iiy8QMpIauaqBt0bQty260aNsRw5x32lHXWiP4Pt/i5fkZpRRQtkJVj4bv5WdjsCGWwSFJsTskkK65yOZWMEMKSJecZjl8g38KdBZwFQtoVY7U3x3x1OHakTmgFAL7KOIXuuZ0E8Nwu8Pvl1fMF0vGbL7A69sMb7M515w2FkobLvCq8r3s4X2HXueARSHYsRCyq7tCcNHmhYCQkkE1d435yHCzwTaKcRCGW81Yy61EWY2xbGStO0paU0pDaY26ac7vcHeIub2cq3hBc5fYUWrToZ8PQQnNpYBhVsJojf8ZfwcMQ+5XGpSRNofMJJsbanCw4YDb3R6r9QaL5QrrTYjlas36JtyyvlqveZ++p+OLnrw03TuVHbce3QW9pPeeL7mu64s4/QyOwGnrJSmoFikbOXrf40z3H4JYkg19X38ArNd6hnj4sDIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__11.59.15.png\"\n        title=\"2020-07-20__11.59.15.png\"\n        src=\"/static/1bf5917a0214c8441e8cead4d6a7df55/37523/2020-07-20__11.59.15.png\"\n        srcset=\"/static/1bf5917a0214c8441e8cead4d6a7df55/e9ff0/2020-07-20__11.59.15.png 180w,\n/static/1bf5917a0214c8441e8cead4d6a7df55/f21e7/2020-07-20__11.59.15.png 360w,\n/static/1bf5917a0214c8441e8cead4d6a7df55/37523/2020-07-20__11.59.15.png 720w,\n/static/1bf5917a0214c8441e8cead4d6a7df55/302a4/2020-07-20__11.59.15.png 1080w,\n/static/1bf5917a0214c8441e8cead4d6a7df55/d5b59/2020-07-20__11.59.15.png 1370w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Log를 남기겠습니다.</li>\n<li>IAM 역할을 지정\n<ul>\n<li>새로 만들어야 한다면 <code class=\"language-text\">> 정책문서</code> 를 클릭하여 나오는 JSON을 참고하여 생성</li>\n</ul>\n</li>\n<li><code class=\"language-text\">다음</code></li>\n</ul>\n<h3 id=\"1-로그-이벤트-선택\" style=\"position:relative;\"><a href=\"#1-%EB%A1%9C%EA%B7%B8-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EC%84%A0%ED%83%9D\" aria-label=\"1 로그 이벤트 선택 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(1) 로그 이벤트 선택</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/UlEQVQ4y51Ta3PTMBD0//9ZDHwpAx0ehZa0sVtomkSyJFtvy/HCnVNIAjOl1cyO7LvTae9uVV18+Ypvi2u8ev0G796f4/zDR5DNeQ/Tdej6/lmotkLwQdm22G4FlNLs8CHAez/vR/AIJ3DeMQFrHSohJc7O3uJ2o2B9RPCenc45TuDcHGidY5v1AdpFKBth3IyUM0opCCGg6q1FqzSzpJ0Ytkrxbkw3/7cKslWzvbO4Vw53ct4bYeFCQikDE6hiDDDGcHm0dtOEaZrwrzVhAth37N/tdnyGmFZt53B106CuGyht0FvHAbTKOHLJMcbjxHQ4JYQQkVL+bR+GAdVKOzQPApv1mhOGGLlnOQ/QxqC5vcOP+xUnppKIBV1K9mXd4GG9QYyJL4gpoaIpUYJSRg6mROSkJlMSbTpOTN+Zmr9nTT0lApSMzlA8l0yMxnHkwJwTMyQQm8fvQzza4x6HPlJCRRNc1jUWi2uspYEPf4KfA6qKBluRoC+vFvj0+QLL7ytshIRSiqUiZAvSKWErZnRdxxIZcuYhHCLMsoksWJbKNGEcC/eDejrvJxhHbtEpSBk8FKr7Zlnz7T0Pp+ClK5NshlLg6UnFjFpapL3mpr3A/xecMA+oiFHf95CyxWYrIYTkcl+yWNgkg/kdK2itobSG9+EvSTwFnsWvKf8E7YnVaO+yuCsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__12.59.21.png\"\n        title=\"2020-07-20__12.59.21.png\"\n        src=\"/static/e3c197c86cb639208a6d5e00977b6806/37523/2020-07-20__12.59.21.png\"\n        srcset=\"/static/e3c197c86cb639208a6d5e00977b6806/e9ff0/2020-07-20__12.59.21.png 180w,\n/static/e3c197c86cb639208a6d5e00977b6806/f21e7/2020-07-20__12.59.21.png 360w,\n/static/e3c197c86cb639208a6d5e00977b6806/37523/2020-07-20__12.59.21.png 720w,\n/static/e3c197c86cb639208a6d5e00977b6806/302a4/2020-07-20__12.59.21.png 1080w,\n/static/e3c197c86cb639208a6d5e00977b6806/e40ed/2020-07-20__12.59.21.png 1378w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>수정된 목록만 받아 볼 예정이기 때문에 API 활동 → 쓰기 에만 체크 합니다.</li>\n<li><code class=\"language-text\">다음</code>\n<ul>\n<li>검토 및 생성</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA90lEQVQoz52R626DMAyF8/4PuLXSRCeGNgKEQS6OQwhnSqpOpUOTth+fHNknx3YiXuSMUVu0ssVHK6GNwax1if9BPD2fcDqf0Y8TJp2T+k+GWXuPqC6vqKoKtVRQkz4U/UbWW+dgnb1O2EoJCguWEMDM8MwlPuJveL/TWOsgux7DoGCthaibd8jJIYSAkI2Xn+Ta7Rxj3OUcUXn7bOocQXRSYltjmTCL+BHmcjGvY6zF0I8gR1ct87dxbkTeQ3waguMIChFrSkgHbFvCuq6Ffu5AwWHbtr0mpWIsGmXw1s9oBg3jqHQhOsBfaVQNNSt4z2Xd+3r+nC84m2kj8ELXTwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__1.08.19.png\"\n        title=\"2020-07-20__1.08.19.png\"\n        src=\"/static/5a1a0631c037a6c27f761401ab6d5370/37523/2020-07-20__1.08.19.png\"\n        srcset=\"/static/5a1a0631c037a6c27f761401ab6d5370/e9ff0/2020-07-20__1.08.19.png 180w,\n/static/5a1a0631c037a6c27f761401ab6d5370/f21e7/2020-07-20__1.08.19.png 360w,\n/static/5a1a0631c037a6c27f761401ab6d5370/37523/2020-07-20__1.08.19.png 720w,\n/static/5a1a0631c037a6c27f761401ab6d5370/302a4/2020-07-20__1.08.19.png 1080w,\n/static/5a1a0631c037a6c27f761401ab6d5370/52ab5/2020-07-20__1.08.19.png 1420w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"2-serverless-framwork-로-작성한-코드-사용하기\" style=\"position:relative;\"><a href=\"#2-serverless-framwork-%EB%A1%9C-%EC%9E%91%EC%84%B1%ED%95%9C-%EC%BD%94%EB%93%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"2 serverless framwork 로 작성한 코드 사용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. serverless-framwork 로 작성한 코드 사용하기</h2>\n<h3 id=\"1-panopticon-받기\" style=\"position:relative;\"><a href=\"#1-panopticon-%EB%B0%9B%EA%B8%B0\" aria-label=\"1 panopticon 받기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(1) Panopticon 받기</h3>\n<p><a href=\"https://github.com/narashin/AWS-CloudTrail-Panopticon\">narashin/AWS-CloudTrail-Panopticon</a></p>\n<p>🔼Panopticon 받기</p>\n<h3 id=\"2-serverless-설치\" style=\"position:relative;\"><a href=\"#2-serverless-%EC%84%A4%EC%B9%98\" aria-label=\"2 serverless 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(2) serverless 설치</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> serverless</code></pre></div>\n<h3 id=\"3-deploy-전-환경변수-설정하기\" style=\"position:relative;\"><a href=\"#3-deploy-%EC%A0%84-%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"3 deploy 전 환경변수 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(3) deploy 전 환경변수 설정하기</h3>\n<ul>\n<li><code class=\"language-text\">serverless.yml</code> 생성</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token literal-property property\">service</span><span class=\"token operator\">:</span> cloudwatch<span class=\"token operator\">-</span>ec2<span class=\"token operator\">-</span>sg\n\n<span class=\"token literal-property property\">provider</span><span class=\"token operator\">:</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> aws\n  <span class=\"token literal-property property\">runtime</span><span class=\"token operator\">:</span> nodejs12<span class=\"token punctuation\">.</span>x\n  <span class=\"token literal-property property\">stage</span><span class=\"token operator\">:</span> dev\n  <span class=\"token literal-property property\">region</span><span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Region</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  iamRoleStatements:\n    - Effect: \"Allow\"\n      Action:\n        - \"ec2:DescribeSecurityGroups\"\n      Resource: \"*\"\n  environment: \n    SLACK_URL: \"&lt;보낼 채널의 WEBHOOK_URL>\"\n\nfunctions:\n  panopticon:\n    handler: handler.panopticon\n    events:\n      - cloudwatchEvent:\n          event:\n            source:\n              - \"aws.ec2\"\n            detail-type:\n              - \"AWS API Call via CloudTrail\"\n            detail:\n                eventSource:\n                    - \"ec2.amazonaws.com\"\n                eventName:\n                    - \"CreateSecurityGroup\"\n                    - \"DeleteSecurityGroup\"\n                    - \"RevokeSecurityGroupIngress\"\n                    - \"RevokeSecurityGroupEgress\"\n                    - \"AuthorizesecuritygroupIngress\"\n                    - \"AuthorizesecuritygroupEgress\"</span></code></pre></div>\n<ul>\n<li>Nodejs12.x</li>\n<li>iamRole : <code class=\"language-text\">\"ec2:DescribeSecurityGroups\"</code> 허용</li>\n<li>CloudwatchEvent On\n<ul>\n<li>EC2 Event Source 들\n<ul>\n<li>“CreateSecurityGroup”</li>\n<li>“DeleteSecurityGroup”</li>\n<li>“RevokeSecurityGroupIngress”</li>\n<li>“RevokeSecurityGroupEgress”</li>\n<li>“AuthorizesecuritygroupIngress”</li>\n<li>“AuthorizesecuritygroupEgress”</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"4-code-classlanguage-textsls-deploycode-하기\" style=\"position:relative;\"><a href=\"#4-code-classlanguage-textsls-deploycode-%ED%95%98%EA%B8%B0\" aria-label=\"4 code classlanguage textsls deploycode 하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(4) <code class=\"language-text\">sls deploy</code> 하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ sls deploy</code></pre></div>\n<ul>\n<li>먼저 프로그래밍 방식의 IAM AWS Access Key, Secret Key로 aws configure가 작성 되어있어야 함.\n<ul>\n<li><code class=\"language-text\">aws configure</code> 로 확인.</li>\n</ul>\n</li>\n<li>Serverless 가 설치되어 있어야 함.</li>\n<li>Slack Webhook URL이 설정되어 있어야 함.</li>\n</ul>\n<h2 id=\"3-실제-동작-화면\" style=\"position:relative;\"><a href=\"#3-%EC%8B%A4%EC%A0%9C-%EB%8F%99%EC%9E%91-%ED%99%94%EB%A9%B4\" aria-label=\"3 실제 동작 화면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 실제 동작 화면</h2>\n<h3 id=\"1-보안그룹-생성\" style=\"position:relative;\"><a href=\"#1-%EB%B3%B4%EC%95%88%EA%B7%B8%EB%A3%B9-%EC%83%9D%EC%84%B1\" aria-label=\"1 보안그룹 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(1) 보안그룹 생성</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABUElEQVQoz51TTWuDQBDdn9q/kRyFHqq9lfYHlKSnnnorBC1IDukhhRz0UGPd+IklGA0ksUZfGG3SaiExfTDsMMy+ffOxLI5jzOdzRFFUnmRBEMB1Xdi2Dc/zDv5mswGhKApUKGo+GZvNZtA0DXSuViukaYo9KLlpzTjh1dtCtSkOMN/3MTWmJSGpS5KkoaKO36T5t3//luLi0YL+GYCRutFohMlkguVy+efSaYU5VA5cvih4fn8C6/V6EAQBoihCluXahTb4ycvxtc3AOOewLAuLaFEqDMMQ6/X6aNnNRyu/ijNucQyHQ6iqWk6TJpllWQvCvdXbwBzHwUO/D/FKhGEYlfg8b11yE4x7IW5u7yBJEiTpGoqi1EjPJWbmB4csKxgMBjBNE7Top8o9SujYdjkUIqNfQYtN6s6d9oGQFlvX9XJ1Op0Out0uxuPxv3u5A0BHlX4wHZXDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__1.43.36.png\"\n        title=\"2020-07-20__1.43.36.png\"\n        src=\"/static/1d55a5a815fa29d48ba12e24f119055c/37523/2020-07-20__1.43.36.png\"\n        srcset=\"/static/1d55a5a815fa29d48ba12e24f119055c/e9ff0/2020-07-20__1.43.36.png 180w,\n/static/1d55a5a815fa29d48ba12e24f119055c/f21e7/2020-07-20__1.43.36.png 360w,\n/static/1d55a5a815fa29d48ba12e24f119055c/37523/2020-07-20__1.43.36.png 720w,\n/static/1d55a5a815fa29d48ba12e24f119055c/302a4/2020-07-20__1.43.36.png 1080w,\n/static/1d55a5a815fa29d48ba12e24f119055c/8d68c/2020-07-20__1.43.36.png 1234w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"2-보안그룹-삭제\" style=\"position:relative;\"><a href=\"#2-%EB%B3%B4%EC%95%88%EA%B7%B8%EB%A3%B9-%EC%82%AD%EC%A0%9C\" aria-label=\"2 보안그룹 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(2) 보안그룹 삭제</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABV0lEQVQoz51Sy2rCQBSdf3Xtzn0huy4rgrtAESlIRXARd9JNFyHZBLpRQZOYNA+M5mGEhM6cMiMD9qGtXrgzZx73cO6DFHmB3XaHNE2RZZnwZJMgCAL4vo8oioRznOc5uDHGIO0UAwxkuVzCsizM53MRcDgccMkkAd8pPWJrkeF+4MJYVSBxHMPzPIRhKFQWRSE+n3NJJgjFmcEIGe4e3+ANRiC6rmOiTTCdTuE4zpeAU3zujhOmH8BmYQOjJ5But4tms4lWq4V+v3+mNpdKcKydXEnwHoCnXVc1KKUC7/f7P0n5k1QoMaMUxLZtjMdjDJ+HME0TZVmirusrVDKhTJaArNcueNqKokDTtKtT/m4k3OZ4edXRbj9AVVV0Oh0kSfKjOf8mdFwPumEKdXwWeaerqrpZJeEzaK9WcF0XcRT/OsBXEfqeL5TNZjMxOo1GA71e7+aUPwE+8pM55119CwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__1.42.49.png\"\n        title=\"2020-07-20__1.42.49.png\"\n        src=\"/static/232b4815a9294d4c0ba508a993e3d8e3/37523/2020-07-20__1.42.49.png\"\n        srcset=\"/static/232b4815a9294d4c0ba508a993e3d8e3/e9ff0/2020-07-20__1.42.49.png 180w,\n/static/232b4815a9294d4c0ba508a993e3d8e3/f21e7/2020-07-20__1.42.49.png 360w,\n/static/232b4815a9294d4c0ba508a993e3d8e3/37523/2020-07-20__1.42.49.png 720w,\n/static/232b4815a9294d4c0ba508a993e3d8e3/302a4/2020-07-20__1.42.49.png 1080w,\n/static/232b4815a9294d4c0ba508a993e3d8e3/5c744/2020-07-20__1.42.49.png 1206w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"3-보안그룹-수정\" style=\"position:relative;\"><a href=\"#3-%EB%B3%B4%EC%95%88%EA%B7%B8%EB%A3%B9-%EC%88%98%EC%A0%95\" aria-label=\"3 보안그룹 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(3) 보안그룹 수정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6klEQVQ4y51Uu27iQBSdX6ZciSJbgJSlQZuChmK7JRVF2igVUhoigYQjzMPGLzCxeXnNYmPss7qXQAwBVmSko/E8fObMuXOv+K3cw7UdGIYB27YxGo0Yw+EQuq7zvGmasCyLv1VV5fXNZoPjliQJhGoq6Ha7mEwmvCmKIqzXa0YYhAiCAGEY7rFarbiPk4RJ/GWEp2cbL68ej4WhGej1etC1rRo6nZT6f3xcau988IIY3x4m+PXYAdZ/ITRNgyzLTEIqfd9n6XEcc38JQIIgBp7aNtSXChBHELlcDplMBtlsFo1GY+9Fuj+vcre+9ZNGotPpQJIkDsJ8Psdisdgb/qHkPBnfJnkfU1BarRaazSZHdDweYzabHRBeVEcHHh0sCj9u8f3mBoVCAf1+nyfJv682IfcH+Hl3h1KphHK5jHa7vSf9n4cnCV/lHiqVe1SrVdRqNfYy7d+1ELqmcSa4jnsmglcqJEX1eh35fJ5RLBY5QOlrX6WQUoueCz1u8k9qSRxpItsh/UN6/hhMSElPcBwH0+mUQRZ4nnfgJT2ldKDOWSIody1zS0gF4ZSPy+USA3XAAXNd92D905VJHW2knKbiQNXmMF/B+U2q6XBFUTgBPud1WqFl8aYdOZEeK9wRUhGhfW/jt5PX/weE+BT3+UhpIwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__1.43.51.png\"\n        title=\"2020-07-20__1.43.51.png\"\n        src=\"/static/b1a819fcbb26d6562b61c8ef4732069e/37523/2020-07-20__1.43.51.png\"\n        srcset=\"/static/b1a819fcbb26d6562b61c8ef4732069e/e9ff0/2020-07-20__1.43.51.png 180w,\n/static/b1a819fcbb26d6562b61c8ef4732069e/f21e7/2020-07-20__1.43.51.png 360w,\n/static/b1a819fcbb26d6562b61c8ef4732069e/37523/2020-07-20__1.43.51.png 720w,\n/static/b1a819fcbb26d6562b61c8ef4732069e/302a4/2020-07-20__1.43.51.png 1080w,\n/static/b1a819fcbb26d6562b61c8ef4732069e/5a791/2020-07-20__1.43.51.png 1248w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>보안그룹 상세 추가 수정</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACN0lEQVQ4y51UO4/aQBDef0pNQw1cilT0d4D4AclRUCEeadIBCkXQwUU6FHCEhY1twAbOPMTbXzSDFuHwOJGRPljY2W/nm50ZsX55wcR14dg2bNvGcDBk9Ho9aJoGXddhGMbxd7fbheu6IPM8D37zICxVRafTYbLdbsfYbrdYrVZYLpeM0zWB9iXXcrXDz1cbr79d7PaA6Oo6/igKdE0/RkPk+/0et0xGt9p6+Fwc4fGbCm+1gCAJrVYLpmFiOBxiMplwlHTgI5DErQd8b7/j7cczsJ5CRKNRBAIBBINBlEol3+3nOfLni3QfPLYA1rwWzWYT9XodqqpiPB5jNptxhJLwGqknyTwP+wM3fwh6PZJNZCTXsR1O+kcR8t6JEukrPj08IBQKIRKJcKRkMsL/MVH/9YbHpyckEgmk02koisIb9Mq3c3iFUFE1fPn6zGTFYhHtdtsn414IrdvlLphOpxfr7O4IDcNEpVJBOBxmxGIxLvBT2XdFSK1EBV2tVhnlchmj0ehIKCEPnP73L5jQMi2YpsklQyAyqknHcXy5PH0kWm82Gy4vWWJHyYPBAASK8pqRCsoz+cmLruVb9Pt9dqahUKvVkEqljqA9svl8zvukhL6pGuLxOJLJJDKZjE+JIAeac3Q7lUw+n0ehUGBQ95AtFgsmoseidaPRQDabRS6X8/W/J1uPCGnaXOoQ6Shn5aVyOpNMUojUsixO+K3D8lGkj5ybxwg5h3qP5R0m8XnDn8/B65PoL/5x8YIeI209AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020-07-20__1.43.24.png\"\n        title=\"2020-07-20__1.43.24.png\"\n        src=\"/static/69c06d5cd222c816285887263aa838cd/37523/2020-07-20__1.43.24.png\"\n        srcset=\"/static/69c06d5cd222c816285887263aa838cd/e9ff0/2020-07-20__1.43.24.png 180w,\n/static/69c06d5cd222c816285887263aa838cd/f21e7/2020-07-20__1.43.24.png 360w,\n/static/69c06d5cd222c816285887263aa838cd/37523/2020-07-20__1.43.24.png 720w,\n/static/69c06d5cd222c816285887263aa838cd/302a4/2020-07-20__1.43.24.png 1080w,\n/static/69c06d5cd222c816285887263aa838cd/8affb/2020-07-20__1.43.24.png 1254w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>보안그룹 상세 삭제</li>\n</ul>","excerpt":"0. 시나리오 AWS 보안그룹이 수정, 생성, 삭제 됐을 때 알림을 받고 싶다. CloudTrail 을 이용하여 Write 된 내역을 추적한다. CloudWatch Event 를 통해 1 중, 특정 이벤트(EC2 Security Group 편집)가 발생했을 때 Lambda를 호출하게 한다. Lambda에 Slack 메시지를 보낼 수 있게 코드를 작성한다. 이 모든 과정에 필요한 IAM Role, CloudWatch Event, Lambda 등을 따로 작성하지 않고 Serverless Framwork 를 이용하여 Wrapping 된 파일을 이용한다. 1. CloudTrail 설정하기  CloudTrail → 추적 생성 (0) 추적 속성 선택  추적 이름 지정 스토리지 위치 지정 - 새 S3 버킷에 생성해도 되고, 기존 버킷을 이용해도 OK  KMS를 사용한다면 KMS 키 설정  Log를 남기겠습니다. IAM 역할을 지정 새로 만들어야 한다면  를 클릭하여 나오는 JSON을 참고하여 …","frontmatter":{"date":"January 01, 2022","title":"Panopticon","categories":"craft","author":"신나라","emoji":"🔨"},"fields":{"slug":"/panopticon/"}},"next":{"id":"1023ff97-58ca-5ea9-bbc4-e8c86a965387","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVQoz52SS2/TQBSF89/5H92wZRUJFlRsKCs2KAmiSpuapITGNn40L4/ncedDsZ1JTKsKuNJ4rPGdb84ZnwFnpbVuZu99GP9ag+OmPM8ZDodUVRWg/1MBaIwhiiLW6/WzKv/2gMGxuSgK4jgmyzKcc72mE7R7nMH/PDQoTNO0AR5ghzVrbaP6MPeh0lPvRZq1ADy8iBfSJGF6uyArFXslLB+yZihlTsAXbB+hDdBZYVPueFgmpHFO3UG0Nry6+Mh630GB3dUHzHKBFo9xnuTygmr8vv0urgVaLaxWMZOvE66/XVPt6qZhs93y7mpCXrY/yonwczziMYmxzrFXNfPL15TTz0FlABZ5SRTdMZ8vUHvd3ZEcDTUwEenZFHHUAsq45i6DZaMFVSlms1vKssQZ3xr0nrdfLDerE2h0XzNZqBboeZKGoHC73jO7+c6vJEdtLVpZ1E7z5lPJ+G4H1lFtKkbTmNmP4oDrEtTPa8ihNcJjWmFqh8hZmL0GaaOjjaHIEoosxVr3bOB/A854pxdRNqG9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"efish-architecture\"\n        title=\"efish-architecture\"\n        src=\"/static/227c370838b062ddaa19856caceca58e/37523/efish-architecture.png\"\n        srcset=\"/static/227c370838b062ddaa19856caceca58e/e9ff0/efish-architecture.png 180w,\n/static/227c370838b062ddaa19856caceca58e/f21e7/efish-architecture.png 360w,\n/static/227c370838b062ddaa19856caceca58e/37523/efish-architecture.png 720w,\n/static/227c370838b062ddaa19856caceca58e/302a4/efish-architecture.png 1080w,\n/static/227c370838b062ddaa19856caceca58e/07a9c/efish-architecture.png 1440w,\n/static/227c370838b062ddaa19856caceca58e/3a5d5/efish-architecture.png 1807w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>","frontmatter":{"date":"January 01, 2022","title":"Efish","categories":"craft","author":"신나라","emoji":"🔨"},"fields":{"slug":"/efish/"}},"prev":{"id":"a08a4a47-7039-562d-89c5-1a746e07c4cc","html":"<p>협력 업체에서 본인들의 데이터를 다운받을 수 있게 getObject 권한을 <strong>일시적</strong>으로 주었다. 그것은 단 한달.</p>\n<p>우리가 받아야 하는 데이터는 평균 6.26MB 크기로, 대략 1000만개 이상의 mp3 파일들이다.</p>\n<h1 id=\"가장-쉬운-방법-srr\" style=\"position:relative;\"><a href=\"#%EA%B0%80%EC%9E%A5-%EC%89%AC%EC%9A%B4-%EB%B0%A9%EB%B2%95-srr\" aria-label=\"가장 쉬운 방법 srr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>가장 쉬운 방법 SRR</h1>\n<p><img src=\"/9b0c99d3eee8429cad6aae919ce8a720/6-giphy.gif\" alt=\"giphy.gif\"></p>\n<p>SRR은 동일 리전 복제(Same Region Replication)의 줄임말로 AWS에서 정식으로 지원하고 있는 기능이다. 새로 업로드된 S3 객체를 동일한 AWS 리전에서 대상 버킷으로 비동기식 자동 복제를 지원한다.</p>\n<p>이 때까지만 해도 데이터가 실시간으로 올라오고 우리는 실시간 sync에 가깝게 bucket을 <strong>복사</strong>한다고 착각했기 때문에 가장 먼저 떠오른 방법이다. 하지만 신작을 copy하는 것이 아닌 구작을 뒤늦게 받아오는 작업이었고 다른 방법이 필요했다.</p>\n<h2 id=\"-새로-올라오는-데이터가-아닌데\" style=\"position:relative;\"><a href=\"#-%EC%83%88%EB%A1%9C-%EC%98%AC%EB%9D%BC%EC%98%A4%EB%8A%94-%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B0%80-%EC%95%84%EB%8B%8C%EB%8D%B0\" aria-label=\" 새로 올라오는 데이터가 아닌데 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>😵 새로 올라오는 데이터가 아닌데?</h2>\n<p>(물론 교차 계정 SRR에도 권한 조정 문제가 필요하지만) SRR을 쓰지 않고 버킷에서 버킷으로 copy를 하려고 한다면, 소스 버킷의 Bucket policy에서 데스티네이션 버킷에 권한을 따로 풀어주는 선언문이 필요했다.</p>\n<p>하지만 소스 버킷의 bucket policy 는 우리가 건드릴 수 있는 영역이 아니었다. (이부분에서 안일하게 생각했던 것이, 과거 경험에서는 “제가 말한대로 바꿔야 가격효율적입니다.”라고 말하면 바로 바꿔주는 고객을 많이 만났기 때문에 당연히 bucket policy도 쉽게 바꿀 수 있을 것이라고 생각했다.)</p>\n<h3 id=\"-우리가-건드릴-수-있는-영역권한이-아닌데\" style=\"position:relative;\"><a href=\"#-%EC%9A%B0%EB%A6%AC%EA%B0%80-%EA%B1%B4%EB%93%9C%EB%A6%B4-%EC%88%98-%EC%9E%88%EB%8A%94-%EC%98%81%EC%97%AD%EA%B6%8C%ED%95%9C%EC%9D%B4-%EC%95%84%EB%8B%8C%EB%8D%B0\" aria-label=\" 우리가 건드릴 수 있는 영역권한이 아닌데 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>+ 우리가 건드릴 수 있는 영역<del>권한</del>이 아닌데?</h3>\n<p>권한을 조정하면 bucket에서 bucket으로 직접 전송이 가능하기 때문에 불필요한 단계를 많이 건너뛸 수 있는데, 이를 할 수 없게 되었으니 다른 방법을 강구해야 했다.</p>\n<h1 id=\"charon\" style=\"position:relative;\"><a href=\"#charon\" aria-label=\"charon permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Charon</h1>\n<p>Ralph가 Boto3를 이용하여 만든 Worker</p>\n<p>이미 위와 같은 여러 좌절적인 케이스를 경험한 랄프는 S3 Import를 도와줄 워커를 직접 만들기로 결심한 것 같았다. (내가 팀에 합류한 이후에도 한번더 더 쉬운 방법이 없는지 물어보셨지만, 본인이 리서치한 결과와 크게 다르지 않아서 많이 실망하셨을 것 같다.)</p>\n<p>그리고 랄프가 만든 카론이 열심히 S3 Import 작업을 하고 있었다.</p>\n<ul>\n<li>Python</li>\n<li>pod에서 작동중 (m5.xlarge)</li>\n<li>import 속도 : 1초 약 1.3개</li>\n</ul>\n<p>하지만 카론의 속도로는 24시간 풀로 돌아가도, 모든 파일을 받아오는 데에 대략 <em>90여일</em>이 걸려 마감기한까지 데이터를 모두 받아올 수 없는 상황이었다.</p>\n<p>python 으로 되어있는 boto3와, 워커가 올라가 있는 인스턴스의 네트워크 대역폭이 가장 큰 한계점이라고 생각했다.</p>\n<h1 id=\"s5cmd\" style=\"position:relative;\"><a href=\"#s5cmd\" aria-label=\"s5cmd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>s5cmd</h1>\n<p>이 때 떠오른 것이 s5cmd 이다. go로 만들어져있고 여러 tcp 연결을 더 잘 활용하여 개체 저장소로 더 많은 데이터를 전송하여 매우 빠르다는 <a href=\"https://joshua-robinson.medium.com/s5cmd-for-high-performance-object-storage-7071352cc09d\">벤치마크 포스팅</a>을 본 기억이 나서 이를 차용해보기로 했다.</p>\n<p><a href=\"https://aws.amazon.com/ko/blogs/opensource/parallelizing-s3-workloads-s5cmd/\">Parallelizing S3 Workloads with s5cmd | Amazon Web Services</a></p>\n<h2 id=\"사용법\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%EB%B2%95\" aria-label=\"사용법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용법</h2>\n<p><img src=\"/401b126ad0fe7bda7a653a17a83e4462/2-s5cmd-3a.gif\" alt=\"s5cmd-3a.gif\"></p>\n<p>사용법은 간단하다. golang을 먼저 설치하고, s5cmd를 설치.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">go get <span class=\"token parameter variable\">-u</span> github.com/peakgames/s5cmd</code></pre></div>\n<p>s3를 이용할 AWS 계정의 Credentials file을 작성한다. <code class=\"language-text\">~/.aws/credetials</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>default<span class=\"token punctuation\">]</span>\naws_access_key_id <span class=\"token operator\">=</span> XXXXXXX\naws_secret_access_key <span class=\"token operator\">=</span> YYYYYYYY</code></pre></div>\n<h3 id=\"다운로드\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C\" aria-label=\"다운로드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다운로드</h3>\n<p><strong>하나의 파일을 받을 때</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">s5cmd <span class=\"token function\">cp</span> s3://prod-wmg-s3delivery/DSP_7804/20210925132945877/ <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p><strong>여러개 파일을 받을 때</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">s3://prod-wmg-s3delivery/DSP_7804/20210925132945877/\ns3://prod-wmg-s3delivery/DSP_7804/20210925132945234/\ns3://prod-wmg-s3delivery/DSP_7804/20210925132342137/</code></pre></div>\n<p>와일드카드를 쓸 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">s5cmd <span class=\"token function\">cp</span> <span class=\"token string\">'s3://prod-wmg-s3delivery/DSP_7804/2021092513*'</span> <span class=\"token builtin class-name\">.</span></code></pre></div>\n<h3 id=\"업로드\" style=\"position:relative;\"><a href=\"#%EC%97%85%EB%A1%9C%EB%93%9C\" aria-label=\"업로드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>업로드</h3>\n<p><strong>하나의 파일만 올릴 때</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">s5cmd cp object.gz s3://music-distributor/wmg/New\\ Release/\n</code></pre></div>\n<p><strong>여러개 파일을 올릴 때</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/s5cmd cp '20210925*' s3://music-distributor/wmg/New\\ Release/\n</code></pre></div>\n<h3 id=\"주의할-점\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9D%98%ED%95%A0-%EC%A0%90\" aria-label=\"주의할 점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주의할 점</h3>\n<p>이미 작업을 할 EC2 Instance에 데스티네이션 bucket에 대한 Role이 지정되어 있으므로, 인스턴스 내에서 <code class=\"language-text\">aws configure</code> 를 통해 credentials값을 재정의하면 EC2 Role이 덮어씌워짐.</p>\n<h2 id=\"결과\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC\" aria-label=\"결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABK0lEQVQoz52Ry07CQBSG58lM3Hl5FN9LXcDCnTHAzkRlYQImEkpS24FWSqdXtJ1zZnpIW1MgtBu/xWTyn8v/Z4alaWqaJufctm3HcTjnpmk6jqO1LjrQBdVVRkS1RMccdev9hYiM1e/3JkKQjLqpN4aLZHDzGlvbUtGaiMR6EQYeADJdcepctZaiNwnuz5/ELCYq0xLRMjY84YJEBgCIqNtQqOrh/tXIn0VEpKBUguVP6CeIwBCx1bZx3kzD3sUwmMeN0sBq238OA4CqOAqsNCqlEOrYvcvhX2xUhzFZ12vtnT+i/vUomCctziffU56un75NLSVeClrb7/7d2aP4jDuHASCvyLIsl9Kw/YfBmE9uv6wxd4X1vErFVoLMy6LsdD4MnSMBaKKiq2UHLt2zdXEDQlYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0_80gJDQySaSwU9qWQ.png\"\n        title=\"0_80gJDQySaSwU9qWQ.png\"\n        src=\"/static/1dd71067f4a2568a21c9e013c57fc9a0/37523/3-0_80gJDQySaSwU9qWQ.png\"\n        srcset=\"/static/1dd71067f4a2568a21c9e013c57fc9a0/e9ff0/3-0_80gJDQySaSwU9qWQ.png 180w,\n/static/1dd71067f4a2568a21c9e013c57fc9a0/f21e7/3-0_80gJDQySaSwU9qWQ.png 360w,\n/static/1dd71067f4a2568a21c9e013c57fc9a0/37523/3-0_80gJDQySaSwU9qWQ.png 720w,\n/static/1dd71067f4a2568a21c9e013c57fc9a0/302a4/3-0_80gJDQySaSwU9qWQ.png 1080w,\n/static/1dd71067f4a2568a21c9e013c57fc9a0/c1b63/3-0_80gJDQySaSwU9qWQ.png 1200w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>우리가 받아야 하는 데이터는 평균 6.26MB 크기로, 대략 1000만개 이상의 mp3 파일들이다.</p>\n</blockquote>\n<ul>\n<li>Import 속도 :\n<ul>\n<li>(로컬) 1초 약 2.25개</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"c5nxlarge---네트워크-대역폭이-큰-인스턴스-사용\" style=\"position:relative;\"><a href=\"#c5nxlarge---%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EB%8C%80%EC%97%AD%ED%8F%AD%EC%9D%B4-%ED%81%B0-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%EC%82%AC%EC%9A%A9\" aria-label=\"c5nxlarge   네트워크 대역폭이 큰 인스턴스 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>c5n.xlarge - 네트워크 대역폭이 큰 인스턴스 사용</h3>\n<p>회사에서 지급해준 맥북프로(i9 8core, 32GB)로 회사 네트워크를 사용하여 s5cmd를 통해 S3 Import를 할 때 걸린 시간은 초당 2.25개로 카론의 속도보다 약 2배 빨라졌음을 알 수 있었다. s5cmd의 성능이 로컬 테스트를 통해 어느정도 입증이 되어, 이를 더 좋은 환경에서 구동시켜 효율을 극대화 시키고자 했다.</p>\n<p>기존 카론이 돌아가는 m5.xlarge 사양의 pod이 아닌 네트워크 대역폭이 훨씬 큰 인스턴스를 사용하면 어떻게 될까?</p>\n<h4 id=\"m5xlarge-vs-c5nxlarge\" style=\"position:relative;\"><a href=\"#m5xlarge-vs-c5nxlarge\" aria-label=\"m5xlarge vs c5nxlarge permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>m5.xlarge vs. c5n.xlarge</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA2UlEQVQY03WQ227CMBBE8/9fVZWHChUQNIQ3bm8EycRJfImdy6Cx6lQGdaSVVuv12dnNzqcj1qvvEIvPD+x2WxyKPYp9juXyC5vNKtTz/AfUOI6YpikJKuaZlBXu9xJV9YCUEkopWGvnMMagriW01vhPEUplhF2vFxCcNo1wzs2TmRPedR2897/DNPq+T9xmznV4CBGaWIgrEUBXwzDAGhNyG4A2DG+aOgx4A7Ztg8v5BCFEciMCmVOEERRVljdorZLbzUA6U6qdP8QHOotw9nj/tz6dxY1egU8SjtDr1XDk9QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5 2022 07 213 06 47\"\n        title=\"5 2022 07 213 06 47\"\n        src=\"/static/a8e883e23d6d9859d6f2515ec37dee61/37523/5-2022-07-213.06.47.png\"\n        srcset=\"/static/a8e883e23d6d9859d6f2515ec37dee61/e9ff0/5-2022-07-213.06.47.png 180w,\n/static/a8e883e23d6d9859d6f2515ec37dee61/f21e7/5-2022-07-213.06.47.png 360w,\n/static/a8e883e23d6d9859d6f2515ec37dee61/37523/5-2022-07-213.06.47.png 720w,\n/static/a8e883e23d6d9859d6f2515ec37dee61/302a4/5-2022-07-213.06.47.png 1080w,\n/static/a8e883e23d6d9859d6f2515ec37dee61/d4b10/5-2022-07-213.06.47.png 1394w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>C5n의 ENI(탄력적 네트워크 인터페이스)는 최대 32개의 대기열(C5 및 C5d의 경우 8개)을 사용을 통해 모든 vCPU들에 더욱 효율적으로 분산되는 패킷 처리 워크로드를 가능하게 합니다.</p>\n</blockquote>\n<ul>\n<li>Import 속도\n<ul>\n<li>(c5n.xlarge) 1초 약 11.48개</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACiklEQVQ4y51U30sUURTev6GHIIIoMkzrIUt6CXytp8joKQkKCy0VygfxSSjIH2lJRCJYkT5E5rrbhpmlpmYPGv1w/VG4/lpn1V1mdWZ2x507Ozt3vrh3zBXKXfLAx1zunPNxvvMdrkNRFKiqChamaaYFNSkSpgEjocNIxDegwzQTsCwLDp5EKSdkF6lAqcnzBmbacLfvHB4MFuD+4EXUfbyA2dVv/J8DG8EK0gW1bEKntwZXXu5FqSsbNzoP49qrA5gIDtiEuq4jFotxwnRymVQW7vF6FDsPodyTi1ue4yhzHcHEyqBNyBINw/gvye6JehR1ZHCym69zUOLKxmRwaCeS6faEoU82IeuOEGIXUJoSzEkWrvGthMdQ4spKSo7H49A0bQeEB/9NmE6mxcdhw9ycYcNfkqf+SObuJRJJl2kS9n5aW2Cm75BJZmuzXXvKuo61KMFaVEc4EoNGgE7vPRQ5M1JLZg6u6ypiusq/63oUxCC43vQFpyre43RVP/Iqe3C58TtaR2tR6s7ke1juOYEy99EtkjfmsijO4mx1DvJrc3G+7iTO3MlCnasC+dWj2FXQgf1XPdh9yYm8ys9oHq5CYfseFHdk8gUvbN8H73K/TUiIBjWqIhD041lPI55/eIjW3kdoedeA3q9v0Pr2B24/7UP9i2HUtA3hsXMUI75+dI01odv7BN3eFnSNNWNuZQrUtOCwkHqhLVMHUWVoUQmqEgbVyfa57LVhB7/ow88FLxbm/RDDIndjZFrE9JwfgiAgsLSMlWDIHo0yibmlXxCEABYFPwJLAnwzPsiynDQloslYU0TIkrzpeEgmkOQIJEmCJMlg7ybPJWHI0VUossLvIpEIRFHcrPsNmY+ycAQ6XUIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"스크린샷 2021-11-08 오전 7.23.42.png\"\n        title=\"스크린샷 2021-11-08 오전 7.23.42.png\"\n        src=\"/static/bc4e0e2710ed6f88526725f7b7390fcb/37523/4-2021-11-087.23.42.png\"\n        srcset=\"/static/bc4e0e2710ed6f88526725f7b7390fcb/e9ff0/4-2021-11-087.23.42.png 180w,\n/static/bc4e0e2710ed6f88526725f7b7390fcb/f21e7/4-2021-11-087.23.42.png 360w,\n/static/bc4e0e2710ed6f88526725f7b7390fcb/37523/4-2021-11-087.23.42.png 720w,\n/static/bc4e0e2710ed6f88526725f7b7390fcb/c1c45/4-2021-11-087.23.42.png 824w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>S3 Import 속도가 비약적으로 증가했다. Charon 을 이용 했을 때보다 <strong>약 8.8배</strong> 속도 증가를 체감할 수 있었다.</p>\n<p>현재는 c5n.xlarge 인스턴스 2대를 이용하여 S3 Import 작업을 계속하고 있으며, 작업 착수일인 11월 2일부터 지금까지 약 376만여개의 객체를 받아올 수 있었다.</p>","frontmatter":{"date":"January 01, 2022","title":"s3 bucket에서 s3 bucket으로 약 1000만개 파일 옮기기","categories":"craft","author":"신나라","emoji":"💼"},"fields":{"slug":"/s3-to-s3/"}},"site":{"siteMetadata":{"siteUrl":"https://nara.dev","comments":{"utterances":{"repo":"narashin/narashin.github.io"}}}}},"pageContext":{"slug":"/panopticon/","nextSlug":"/efish/","prevSlug":"/s3-to-s3/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}